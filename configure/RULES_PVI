-include $(PVI)/configure/CONFIG_SITE

ifdef BIN_PVI

# Find base names of components from YAML files
PVIS := $(wildcard $(TOP)/pvi/*.pvi.producer.yaml)
COMPONENTS := $(patsubst $(TOP)/pvi/%.pvi.producer.yaml, %, $(PVIS))

ifdef PVI_TEMPLATES

# Add templates to be generated for components to install target
TEMPLATES := $(patsubst %, %Parameters.template, $(COMPONENTS))
install: $(TEMPLATES)

# Rule to create a template file from a PVI yaml file
%Parameters.template: $(TOP)/pvi/%.pvi.producer.yaml
	$(BIN_PVI) produce $@ $<

endif # PVI_TEMPLATES

ifdef PVI_PARAMSETS

# Add ParamSet header files to be generated for components to install target
PARAMSETS := $(patsubst %, %ParamSet.h, $(COMPONENTS))
install: $(PARAMSETS)

# Rule to create a ParamSet header file from a PVI yaml file
%ParamSet.h: $(TOP)/pvi/%.pvi.producer.yaml
	$(BIN_PVI) produce $@ $<

endif # PVI_PARAMSETS

endif # BIN_PVI
