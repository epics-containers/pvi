
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to Write a Site Specific Formatter &#8212; pvi 0.9.dev2+gda785f1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=09809094"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'developer/how-to/write-a-formatter';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://epics-containers.github.io/pvi/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'main';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../../_static/pvi-favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Architectural Decision Records" href="../explanations/decisions.html" />
    <link rel="prev" title="Container Local Build and Test" href="test-container.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/pvi-logo.svg" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../../_static/pvi-logo.svg" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">pvi</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/epics-containers/pvi/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/pvi" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/pvi" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/epics-containers/pvi/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/pvi" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/pvi" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/dev-install.html">Developer install</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contributing to the project</a></li>
<li class="toctree-l1"><a class="reference internal" href="build-docs.html">Build the docs using sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="run-tests.html">Run the tests using pytest</a></li>
<li class="toctree-l1"><a class="reference internal" href="static-analysis.html">Run static analysis using mypy</a></li>
<li class="toctree-l1"><a class="reference internal" href="lint.html">Run linting using pre-commit</a></li>
<li class="toctree-l1"><a class="reference internal" href="update-tools.html">Update the tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="make-release.html">Make a release</a></li>
<li class="toctree-l1"><a class="reference internal" href="pin-requirements.html">Pinning Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="test-container.html">Container Local Build and Test</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">How to Write a Site Specific Formatter</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanations/decisions.html">Architectural Decision Records</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanations/decisions/0001-record-architecture-decisions.html">1. Record architecture decisions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanations/decisions/0002-switched-to-pip-skeleton.html">2. Adopt python3-pip-skeleton for project structure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/original-design.html">Original Design</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reference/standards.html">Standards</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Developer Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">How to...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="how-to-write-a-site-specific-formatter">
<h1>How to Write a Site Specific Formatter<a class="headerlink" href="#how-to-write-a-site-specific-formatter" title="Link to this heading">#</a></h1>
<p>This guide explains how you can create a pvi formatter to generate screens for
your own use cases.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>The formatters role is to take a device.yaml file and turn this into a screen file that
can be used by the display software. Inside of the device.yaml file is a list of
components that specify its name, a widget type and any additional properties that can be
assigned to that widget (such as a pv name). During formatting, the device.yaml file is
deserialised into component objects, which are later translated into widgets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Component</span><span class="p">(</span><span class="n">Named</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;These make up a Device&quot;&quot;&quot;</span>

    <span class="n">label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="n">to_title_case</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SignalR</span><span class="p">(</span><span class="n">Signal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read-only `Signal` backed by a single PV.&quot;&quot;&quot;</span>

    <span class="n">_access_mode</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>

    <span class="n">read_pv</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;PV to use for readback&quot;</span><span class="p">)</span>
    <span class="n">read_widget</span><span class="p">:</span> <span class="n">ReadWidgetUnion</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Widget to use for display. `TextRead` will be used if unset.&quot;</span>
    <span class="p">)</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;read_widget&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_validate_read_widget</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">read_widget</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">read_widget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TextRead</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">read_widget</span>
</pre></div>
</div>
<p>To make a screen from this, we need a template file. This contains a blank representation
of each supported widget for each of the supported file formats (bob, edl etc…). Below
is an example of a ‘text entry’ widget for a .bob file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    &lt;actions&gt;
      &lt;action type=&quot;write_pv&quot;&gt;
        &lt;pv_name&gt;$(pv_name)&lt;/pv_name&gt;
        &lt;value&gt;value&lt;/value&gt;
        &lt;description&gt;$(name)&lt;/description&gt;
      &lt;/action&gt;
    &lt;/actions&gt;
    &lt;text&gt;SignalX&lt;/text&gt;
    &lt;x&gt;18&lt;/x&gt;
    &lt;y&gt;118&lt;/y&gt;
    &lt;width&gt;120&lt;/width&gt;
    &lt;height&gt;40&lt;/height&gt;
    &lt;tooltip&gt;$(actions)&lt;/tooltip&gt;
  &lt;/widget&gt;
  &lt;widget type=&quot;textupdate&quot; version=&quot;2.0.0&quot;&gt;
    &lt;name&gt;TextUpdate&lt;/name&gt;
    &lt;pv_name&gt;TextRead&lt;/pv_name&gt;
</pre></div>
</div>
<p>By extracting and altering the template widgets with the information provided by the
components, we can create a screen file.</p>
</section>
<section id="create-a-formatter-subclass">
<h2>Create a formatter subclass<a class="headerlink" href="#create-a-formatter-subclass" title="Link to this heading">#</a></h2>
<p>To start, we will need to create our own formatter class. These inherit from an abstract
‘Formatter’ class that is defined in base.py. Inside, we need to define one mandatory
‘format’ function, which will be used to create our screen file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Formatter</span><span class="p">(</span><span class="n">TypedModel</span><span class="p">,</span> <span class="n">YamlValidatorMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base UI formatter.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">type_adapter</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeAdapter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create TypeAdapter of all child classes&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TypeAdapter</span><span class="p">(</span>
            <span class="n">as_tagged_union</span><span class="p">(</span><span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">())])</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Formatter&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate a Formatter child class from a dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            serialized: Dictionary of class instance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">type_adapter</span><span class="p">()</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="n">serialized</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">yaml</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Formatter&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate a Formatter child class from YAML.</span>

<span class="sd">        Args:</span>
<span class="sd">            yaml: Path of YAML file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">serialized</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">validate_yaml</span><span class="p">(</span><span class="n">yaml</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a schema of Formatter child classes.</span>

<span class="sd">        Formatter itself is not included, as it should not be instanstiated directly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_rebuild_child_models</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">type_adapter</span><span class="p">()</span><span class="o">.</span><span class="n">json_schema</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To be implemented by child classes to define how to format specific UIs.</span>

<span class="sd">        Args:</span>
<span class="sd">            device: Device to populate UI from</span>
<span class="sd">            path: Output file path to write UI to</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index_entries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">IndexEntry</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format an index of buttons to open the given UIs.</span>

<span class="sd">        Args:</span>
<span class="sd">            label: Title of generated index UI</span>
<span class="sd">            index_entries: Buttons to format on the index UI</span>
<span class="sd">            path: Output path of generated UI</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">Device</span><span class="p">(</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">children</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">DeviceRef</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">enforce_pascal_case</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">label</span><span class="p">),</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                        <span class="n">pv</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                        <span class="n">ui</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span>
                        <span class="n">macros</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">macros</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_entries</span>
                <span class="p">],</span>
            <span class="p">),</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>The format function takes in a device: a list of components obtained from our
deserialised device.yaml file, A prefix: the pv prefix of the device, and a path: the
output destination for the generated screen file.</p>
<p>With a formatter defined, we now can start to populate this by defining the screen
dependencies.</p>
</section>
<section id="define-the-screen-layout-properties">
<h2>Define the Screen Layout Properties<a class="headerlink" href="#define-the-screen-layout-properties" title="Link to this heading">#</a></h2>
<p>Each screen requires a number of layout properties that allow you to customise the size
and placement of widgets. These are stored within a ‘ScrenLayout’ dataclass that can
be imported from utils.py. Within the dataclass are the following configurable parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ScreenLayout</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">spacing</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Spacing between widgets&quot;</span><span class="p">)</span>
    <span class="n">title_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Height of screen title bar&quot;</span><span class="p">)</span>
    <span class="n">max_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Max height of the screen&quot;</span><span class="p">)</span>
    <span class="n">group_label_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Height of the group title label&quot;</span><span class="p">)</span>
    <span class="n">label_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Width of the labels describing widgets&quot;</span><span class="p">)</span>
    <span class="n">widget_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Width of the widgets&quot;</span><span class="p">)</span>
    <span class="n">widget_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Height of the widgets (Labels use this too)&quot;</span>
    <span class="p">)</span>
    <span class="n">group_widget_indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Indentation of widgets within groups. Defaults to 0&quot;</span>
    <span class="p">)</span>
    <span class="n">group_width_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Additional border width when using group objects. Defaults to 0&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>When defining these in our formatter, we have the option of deciding which properties
should be configurable inside of the formatter.yaml. Properties defined as member
variables of the formatter class (and then referenced by the layout properties in the
screen format function) will be available to adjust inside of the formatter.yaml.
Anything else, should be considered as defaults for the formatter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">screen_layout</span> <span class="o">=</span> <span class="n">ScreenLayout</span><span class="p">(</span>
            <span class="n">spacing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
            <span class="n">title_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title_height</span><span class="p">,</span>
            <span class="n">max_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_height</span><span class="p">,</span>
            <span class="n">group_label_height</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span>
            <span class="n">label_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_width</span><span class="p">,</span>
            <span class="n">widget_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_width</span><span class="p">,</span>
            <span class="n">widget_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_height</span><span class="p">,</span>
            <span class="n">group_widget_indent</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
            <span class="n">group_width_offset</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>In the example above, everything has been made adjustable from the formatter.yaml except
the properties relating to groups. This is becuase they are more dependant on the file
format used rather than the users personal preference.</p>
<p>For clarity, the example below shows how the formatter.yaml can be used to set the
layout properties. Note that these are optional as each property is defined with a
default value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yaml-language-server: $schema=../schemas/pvi.formatter.schema.json</span>
<span class="nb">type</span><span class="p">:</span> <span class="n">DLSFormatter</span>
<span class="c1"># Remove screen property to use default value</span>
<span class="n">spacing</span><span class="p">:</span> <span class="mi">4</span>
<span class="n">title_height</span><span class="p">:</span> <span class="mi">26</span>
<span class="n">max_height</span><span class="p">:</span> <span class="mi">900</span>
<span class="n">label_width</span><span class="p">:</span> <span class="mi">120</span>
<span class="n">widget_width</span><span class="p">:</span> <span class="mi">120</span>
<span class="n">widget_height</span><span class="p">:</span> <span class="mi">20</span>
</pre></div>
</div>
</section>
<section id="assign-a-template-file">
<h2>Assign a Template File<a class="headerlink" href="#assign-a-template-file" title="Link to this heading">#</a></h2>
<p>As previously stated, a template file provides the formatter with a base model of all
of the supported widgets that it can then overwrite with component data. Currently,
pvi supports templates for edl, adl and bob files, which can be referenced from the
_format directory with the filename ‘dls’ + the file formats suffix (eg. dls.bob).</p>
<p>Inside of the format function, we need to provide a reference to the template file that
can then be used to identify what each widget should look like:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="o">=</span> <span class="n">BobTemplate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;dls.bob&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="divide-the-template-into-widgets">
<h2>Divide the Template into Widgets<a class="headerlink" href="#divide-the-template-into-widgets" title="Link to this heading">#</a></h2>
<p>With a template defined, we now need to assign each part of it to a supported widget.
This is achieved using the ScreenWidgets dataclass (from utils.py). With this, we can
assign each of the widget classes to a snippet of the template using the
WidgetFactory.from_template method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">widget_formatter_factory</span> <span class="o">=</span> <span class="n">WidgetFormatterFactory</span><span class="p">(</span>
            <span class="n">header_formatter_cls</span><span class="o">=</span><span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Heading&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">label_formatter_cls</span><span class="o">=</span><span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Label&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">led_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;LED&quot;</span><span class="p">,</span>
                <span class="n">sized</span><span class="o">=</span><span class="n">Bounds</span><span class="o">.</span><span class="n">square</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">progress_bar_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ProgressBar&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">bitfield_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;BitField&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">button_panel_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ButtonPanel&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">array_trace_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ArrayTrace&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;y_pv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">image_read_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ImageRead&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">text_read_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;TextUpdate&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">check_box_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ChoiceButton&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">toggle_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ToggleButton&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">combo_box_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ComboBox&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">text_write_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;TextEntry&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">table_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Table&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">action_formatter_cls</span><span class="o">=</span><span class="n">ActionWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;WritePV&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">sub_screen_formatter_cls</span><span class="o">=</span><span class="n">SubScreenWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;OpenDisplay&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;file_name&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;macros&quot;</span><span class="p">:</span> <span class="s2">&quot;macros&quot;</span><span class="p">},</span>
            <span class="p">),</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>This function uses a unique search term to locate and extract a widget from the template.
As such, the search term MUST be unique to avoid extracing multiple or irrelevant
widgets from the template.</p>
</section>
<section id="define-screen-and-group-widget-functions">
<h2>Define screen and group widget functions<a class="headerlink" href="#define-screen-and-group-widget-functions" title="Link to this heading">#</a></h2>
<p>Two widgets that are not handled by ScreenWidgets are the screen title and group object.
This is because the style of these widgets differ greatly for each file type. For
instance, with edl and adl files, groups are represented by a rectangle and title placed
behind a collection of widgets. Conversely, bob files handle groups using its dedicated
group object, which places widgets as children under the group object. Becuase of this,
we need to define two functions: one for the additional screen widgets (such as the title),
and one to represent the group widgets.</p>
<p>We then need to define two functions that can be used to create multiple instances of
these widgets. In this example, we provide two arguments: The ‘bounds’, to set the
widgets size and position, and the ‘title’ to populate the label with.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">screen_title_cls</span> <span class="o">=</span> <span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
            <span class="n">template</span><span class="p">,</span>
            <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span>
            <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">group_title_cls</span> <span class="o">=</span> <span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
            <span class="n">template</span><span class="p">,</span>
            <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span>
            <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">create_group_object_formatter</span><span class="p">(</span>
            <span class="n">bounds</span><span class="p">:</span> <span class="n">Bounds</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">WidgetFormatter</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">group_title_cls</span><span class="p">(</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">Bounds</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">h</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="k">def</span> <span class="nf">create_screen_title_formatter</span><span class="p">(</span>
            <span class="n">bounds</span><span class="p">:</span> <span class="n">Bounds</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">WidgetFormatter</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">screen_title_cls</span><span class="p">(</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">Bounds</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">screen_layout</span><span class="o">.</span><span class="n">title_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>

</pre></div>
</div>
</section>
<section id="construct-a-screen-object">
<h2>Construct a Screen Object<a class="headerlink" href="#construct-a-screen-object" title="Link to this heading">#</a></h2>
<p>Provided that you have defined the LayoutProperties, template, ScreenWidgets and the
screen title and group object functions, we are now ready to define a screen object.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">formatter_factory</span><span class="p">:</span> <span class="n">ScreenFormatterFactory</span> <span class="o">=</span> <span class="n">ScreenFormatterFactory</span><span class="p">(</span>
            <span class="n">screen_formatter_cls</span><span class="o">=</span><span class="n">GroupFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="n">GroupType</span><span class="o">.</span><span class="n">SCREEN</span><span class="p">,</span>
                <span class="n">sized</span><span class="o">=</span><span class="n">with_title</span><span class="p">(</span><span class="n">screen_layout</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="n">screen_layout</span><span class="o">.</span><span class="n">title_height</span><span class="p">),</span>
                <span class="n">widget_formatter_hook</span><span class="o">=</span><span class="n">create_screen_title_formatter</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">group_formatter_cls</span><span class="o">=</span><span class="n">GroupFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="n">GroupType</span><span class="o">.</span><span class="n">GROUP</span><span class="p">,</span>
                <span class="n">sized</span><span class="o">=</span><span class="n">with_title</span><span class="p">(</span>
                    <span class="n">screen_layout</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="n">screen_layout</span><span class="o">.</span><span class="n">group_label_height</span>
                <span class="p">),</span>
                <span class="n">widget_formatter_hook</span><span class="o">=</span><span class="n">create_group_object_formatter</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">widget_formatter_factory</span><span class="o">=</span><span class="n">widget_formatter_factory</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">screen_layout</span><span class="p">,</span>
            <span class="n">base_file_name</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>Note that screen_cls and group_cls are defined separately here as GroupFactories. This is
because they take in the make_widgets function, which has the possibility of returning
multiple widgets. (In edl files for example, we return a rectangle and label widget to
represent a group.)</p>
<p>The screen object itself contains two key functions: The ‘screen’ function takes a
deserialised device.yaml file and converts each of its components into widgets. It then
calculates the size and position of these widgets to generate a uniform screen layout.
On the output of this, we can call a (screen.)format function that populates these widgets
with the extracted properties from the device.yaml, and converts them into the chosen file
format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">screen_formatter</span><span class="p">,</span> <span class="n">sub_screens</span> <span class="o">=</span> <span class="n">formatter_factory</span><span class="o">.</span><span class="n">create_screen_formatter</span><span class="p">(</span>
            <span class="n">device</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">title</span>
        <span class="p">)</span>

        <span class="n">write_bob</span><span class="p">(</span><span class="n">screen_formatter</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sub_screen_name</span><span class="p">,</span> <span class="n">sub_screen_formatter</span> <span class="ow">in</span> <span class="n">sub_screens</span><span class="p">:</span>
            <span class="n">sub_screen_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_screen_name</span><span class="si">}{</span><span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">write_bob</span><span class="p">(</span><span class="n">sub_screen_formatter</span><span class="p">,</span> <span class="n">sub_screen_path</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">write_bob</span><span class="p">(</span><span class="n">screen_formatter</span><span class="p">:</span> <span class="n">GroupFormatter</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
</pre></div>
</div>
</section>
<section id="generate-the-screen-file">
<h2>Generate the Screen file<a class="headerlink" href="#generate-the-screen-file" title="Link to this heading">#</a></h2>
<p>After calling format on the screen object, you will be left with a list of strings that
represent each widget in your chosen file format. The final step is to create a
screen file by unpacking the list and writing each widget to the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># The root:&#39;Display&#39; is always the first element in texts</span>
    <span class="n">texts</span> <span class="o">=</span> <span class="n">screen_formatter</span><span class="o">.</span><span class="n">format</span><span class="p">()</span>
    <span class="n">ET</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">texts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">[:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">ET</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ET</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ET</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;grid_step_y&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
    <span class="n">ET</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">getroottree</span><span class="p">()</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>And thats it. With this you can now create your own custom formatters. Below you can
find a complete example formatter, supporting both edl and bob file formats for DLS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DLSFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="n">spacing</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Spacing between widgets&quot;</span><span class="p">)</span>
    <span class="n">title_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Height of screen title bar&quot;</span><span class="p">)</span>
    <span class="n">max_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">900</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Max height of the screen&quot;</span><span class="p">)</span>
    <span class="n">label_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Width of the widget description labels&quot;</span><span class="p">)</span>
    <span class="n">widget_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Width of the widgets&quot;</span><span class="p">)</span>
    <span class="n">widget_height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Height of the widgets&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.edl&quot;</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_edl</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.bob&quot;</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_bob</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can only write .edl or .bob files&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_edl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">EdlTemplate</span><span class="p">((</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;dls.edl&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
        <span class="n">screen_layout</span> <span class="o">=</span> <span class="n">ScreenLayout</span><span class="p">(</span>
            <span class="n">spacing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
            <span class="n">title_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title_height</span><span class="p">,</span>
            <span class="n">max_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_height</span><span class="p">,</span>
            <span class="n">group_label_height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">label_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_width</span><span class="p">,</span>
            <span class="n">widget_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_width</span><span class="p">,</span>
            <span class="n">widget_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_height</span><span class="p">,</span>
            <span class="n">group_widget_indent</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">group_width_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">widget_formatter_factory</span> <span class="o">=</span> <span class="n">WidgetFormatterFactory</span><span class="p">(</span>
            <span class="n">header_formatter_cls</span><span class="o">=</span><span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;Heading&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">label_formatter_cls</span><span class="o">=</span><span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;Label&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">led_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;LED&quot;&#39;</span><span class="p">,</span>
                <span class="n">sized</span><span class="o">=</span><span class="n">Bounds</span><span class="o">.</span><span class="n">square</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;controlPv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">progress_bar_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;ProgressBar&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;indicatorPv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">text_read_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;TextRead&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;controlPv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">check_box_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;ComboBox&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;controlPv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">toggle_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;ToggleButton&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;controlPv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">combo_box_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;ComboBox&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;controlPv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">text_write_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;TextWrite&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;controlPv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="c1"># Cannot handle dynamic tables so insert a label with the PV name</span>
            <span class="n">table_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;Label&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">action_formatter_cls</span><span class="o">=</span><span class="n">ActionWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;SignalX&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;onLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;offLabel&quot;</span><span class="p">:</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;controlPv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">),</span>
            <span class="n">sub_screen_formatter_cls</span><span class="o">=</span><span class="n">SubScreenWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;SubScreenFile&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;displayFileName&quot;</span><span class="p">:</span> <span class="s2">&quot;file_name&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">bitfield_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;LED&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;controlPv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">button_panel_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;Label&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">array_trace_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;Label&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">image_read_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;Label&quot;&#39;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">screen_title_cls</span> <span class="o">=</span> <span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
            <span class="n">template</span><span class="p">,</span>
            <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;Title&quot;&#39;</span><span class="p">,</span>
            <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">group_title_cls</span> <span class="o">=</span> <span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
            <span class="n">template</span><span class="p">,</span>
            <span class="n">search</span><span class="o">=</span><span class="s1">&#39;&quot;  Group  &quot;&#39;</span><span class="p">,</span>
            <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">group_box_cls</span> <span class="o">=</span> <span class="n">WidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
            <span class="n">template</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s2">&quot;fillColor index 5&quot;</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">create_group_box_formatter</span><span class="p">(</span>
            <span class="n">bounds</span><span class="p">:</span> <span class="n">Bounds</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">WidgetFormatter</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">bounds</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">bounds</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">bounds</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">bounds</span><span class="o">.</span><span class="n">h</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">group_box_cls</span><span class="p">(</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">Bounds</span><span class="p">(</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y</span> <span class="o">+</span> <span class="n">screen_layout</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                        <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                        <span class="n">h</span><span class="o">=</span><span class="n">h</span> <span class="o">-</span> <span class="n">screen_layout</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="n">group_title_cls</span><span class="p">(</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">Bounds</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">screen_layout</span><span class="o">.</span><span class="n">group_label_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">  &quot;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">]</span>

        <span class="k">def</span> <span class="nf">create_screen_title_formatter</span><span class="p">(</span>
            <span class="n">bounds</span><span class="p">:</span> <span class="n">Bounds</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">WidgetFormatter</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">screen_title_cls</span><span class="p">(</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">Bounds</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">screen_layout</span><span class="o">.</span><span class="n">title_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="n">formatter_factory</span><span class="p">:</span> <span class="n">ScreenFormatterFactory</span> <span class="o">=</span> <span class="n">ScreenFormatterFactory</span><span class="p">(</span>
            <span class="n">screen_formatter_cls</span><span class="o">=</span><span class="n">GroupFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="n">GroupType</span><span class="o">.</span><span class="n">SCREEN</span><span class="p">,</span>
                <span class="n">sized</span><span class="o">=</span><span class="n">with_title</span><span class="p">(</span><span class="n">screen_layout</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="n">screen_layout</span><span class="o">.</span><span class="n">title_height</span><span class="p">),</span>
                <span class="n">widget_formatter_hook</span><span class="o">=</span><span class="n">create_screen_title_formatter</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">group_formatter_cls</span><span class="o">=</span><span class="n">GroupFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="n">GroupType</span><span class="o">.</span><span class="n">GROUP</span><span class="p">,</span>
                <span class="n">sized</span><span class="o">=</span><span class="n">with_title</span><span class="p">(</span>
                    <span class="n">screen_layout</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="n">screen_layout</span><span class="o">.</span><span class="n">group_label_height</span>
                <span class="p">),</span>
                <span class="n">widget_formatter_hook</span><span class="o">=</span><span class="n">create_group_box_formatter</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">widget_formatter_factory</span><span class="o">=</span><span class="n">widget_formatter_factory</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">screen_layout</span><span class="p">,</span>
            <span class="n">base_file_name</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">screen_formatter</span><span class="p">,</span> <span class="n">sub_screens</span> <span class="o">=</span> <span class="n">formatter_factory</span><span class="o">.</span><span class="n">create_screen_formatter</span><span class="p">(</span>
            <span class="n">device</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">title</span>
        <span class="p">)</span>

        <span class="n">path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">screen_formatter</span><span class="o">.</span><span class="n">format</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">sub_screen_name</span><span class="p">,</span> <span class="n">sub_screen_formatter</span> <span class="ow">in</span> <span class="n">sub_screens</span><span class="p">:</span>
            <span class="n">sub_screen_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_screen_name</span><span class="si">}{</span><span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sub_screen_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sub_screen_formatter</span><span class="o">.</span><span class="n">format</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">format_bob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">BobTemplate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;dls.bob&quot;</span><span class="p">))</span>
        <span class="c1"># LP DOCS REF: Define the layout properties</span>
        <span class="n">screen_layout</span> <span class="o">=</span> <span class="n">ScreenLayout</span><span class="p">(</span>
            <span class="n">spacing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span>
            <span class="n">title_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title_height</span><span class="p">,</span>
            <span class="n">max_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_height</span><span class="p">,</span>
            <span class="n">group_label_height</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span>
            <span class="n">label_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_width</span><span class="p">,</span>
            <span class="n">widget_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_width</span><span class="p">,</span>
            <span class="n">widget_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">widget_height</span><span class="p">,</span>
            <span class="n">group_widget_indent</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
            <span class="n">group_width_offset</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># SW DOCS REF: Extract widget types from template file</span>
        <span class="n">widget_formatter_factory</span> <span class="o">=</span> <span class="n">WidgetFormatterFactory</span><span class="p">(</span>
            <span class="n">header_formatter_cls</span><span class="o">=</span><span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Heading&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">label_formatter_cls</span><span class="o">=</span><span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Label&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">led_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;LED&quot;</span><span class="p">,</span>
                <span class="n">sized</span><span class="o">=</span><span class="n">Bounds</span><span class="o">.</span><span class="n">square</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">progress_bar_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ProgressBar&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">bitfield_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;BitField&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">button_panel_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ButtonPanel&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">array_trace_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ArrayTrace&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;y_pv&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">image_read_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ImageRead&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">text_read_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;TextUpdate&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">check_box_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ChoiceButton&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">toggle_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ToggleButton&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">combo_box_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;ComboBox&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">text_write_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;TextEntry&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">table_formatter_cls</span><span class="o">=</span><span class="n">PVWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Table&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">action_formatter_cls</span><span class="o">=</span><span class="n">ActionWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;WritePV&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;pv_name&quot;</span><span class="p">:</span> <span class="s2">&quot;pv&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span>
            <span class="p">),</span>
            <span class="n">sub_screen_formatter_cls</span><span class="o">=</span><span class="n">SubScreenWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="s2">&quot;OpenDisplay&quot;</span><span class="p">,</span>
                <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;file_name&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;macros&quot;</span><span class="p">:</span> <span class="s2">&quot;macros&quot;</span><span class="p">},</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># MAKE_WIDGETS DOCS REF: Define screen and group widgets</span>
        <span class="n">screen_title_cls</span> <span class="o">=</span> <span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
            <span class="n">template</span><span class="p">,</span>
            <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span>
            <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">group_title_cls</span> <span class="o">=</span> <span class="n">LabelWidgetFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
            <span class="n">template</span><span class="p">,</span>
            <span class="n">search</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span>
            <span class="n">property_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">create_group_object_formatter</span><span class="p">(</span>
            <span class="n">bounds</span><span class="p">:</span> <span class="n">Bounds</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">WidgetFormatter</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">group_title_cls</span><span class="p">(</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">Bounds</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">h</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="k">def</span> <span class="nf">create_screen_title_formatter</span><span class="p">(</span>
            <span class="n">bounds</span><span class="p">:</span> <span class="n">Bounds</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">WidgetFormatter</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">screen_title_cls</span><span class="p">(</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">Bounds</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">bounds</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">screen_layout</span><span class="o">.</span><span class="n">title_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="c1"># SCREEN_INI DOCS REF: Construct a screen object</span>
        <span class="n">formatter_factory</span><span class="p">:</span> <span class="n">ScreenFormatterFactory</span> <span class="o">=</span> <span class="n">ScreenFormatterFactory</span><span class="p">(</span>
            <span class="n">screen_formatter_cls</span><span class="o">=</span><span class="n">GroupFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="n">GroupType</span><span class="o">.</span><span class="n">SCREEN</span><span class="p">,</span>
                <span class="n">sized</span><span class="o">=</span><span class="n">with_title</span><span class="p">(</span><span class="n">screen_layout</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="n">screen_layout</span><span class="o">.</span><span class="n">title_height</span><span class="p">),</span>
                <span class="n">widget_formatter_hook</span><span class="o">=</span><span class="n">create_screen_title_formatter</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">group_formatter_cls</span><span class="o">=</span><span class="n">GroupFormatter</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
                <span class="n">template</span><span class="p">,</span>
                <span class="n">search</span><span class="o">=</span><span class="n">GroupType</span><span class="o">.</span><span class="n">GROUP</span><span class="p">,</span>
                <span class="n">sized</span><span class="o">=</span><span class="n">with_title</span><span class="p">(</span>
                    <span class="n">screen_layout</span><span class="o">.</span><span class="n">spacing</span><span class="p">,</span> <span class="n">screen_layout</span><span class="o">.</span><span class="n">group_label_height</span>
                <span class="p">),</span>
                <span class="n">widget_formatter_hook</span><span class="o">=</span><span class="n">create_group_object_formatter</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">widget_formatter_factory</span><span class="o">=</span><span class="n">widget_formatter_factory</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">screen_layout</span><span class="p">,</span>
            <span class="n">base_file_name</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># SCREEN_FORMAT DOCS REF: Format the screen</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">screen_formatter</span><span class="p">,</span> <span class="n">sub_screens</span> <span class="o">=</span> <span class="n">formatter_factory</span><span class="o">.</span><span class="n">create_screen_formatter</span><span class="p">(</span>
            <span class="n">device</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">title</span>
        <span class="p">)</span>

        <span class="n">write_bob</span><span class="p">(</span><span class="n">screen_formatter</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sub_screen_name</span><span class="p">,</span> <span class="n">sub_screen_formatter</span> <span class="ow">in</span> <span class="n">sub_screens</span><span class="p">:</span>
            <span class="n">sub_screen_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_screen_name</span><span class="si">}{</span><span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">write_bob</span><span class="p">(</span><span class="n">sub_screen_formatter</span><span class="p">,</span> <span class="n">sub_screen_path</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="test-container.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Container Local Build and Test</p>
      </div>
    </a>
    <a class="right-next"
       href="../explanations/decisions.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Architectural Decision Records</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-formatter-subclass">Create a formatter subclass</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-screen-layout-properties">Define the Screen Layout Properties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assign-a-template-file">Assign a Template File</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#divide-the-template-into-widgets">Divide the Template into Widgets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-screen-and-group-widget-functions">Define screen and group widget functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-a-screen-object">Construct a Screen Object</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-the-screen-file">Generate the Screen file</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/epics-containers/pvi/edit/main/docs/developer/how-to/write-a-formatter.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/developer/how-to/write-a-formatter.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>